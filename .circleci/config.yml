version: 2.1
executors:
  get_dart_sdk:
    docker:
      - image: google/dart
    working_directory: /project

jobs:
  get_sources:
    executor: get_dart_sdk
    steps:
      - checkout
      - persist_to_workspace:
          root: /project
          paths:
            - .

  build_mobx:
    executor: get_dart_sdk
    environment:
      - PACKAGE: mobx
    steps:
      - attach_workspace:
          at: /project
      - run: tool/circle_run.sh

  build_mobx_codegen:
    executor: get_dart_sdk
    environment:
      - PACKAGE: mobx_codegen
    steps:
      - attach_workspace:
          at: /project
      - run: tool/circle_run.sh

  build_mobx_codegen_example:
    executor: get_dart_sdk
    environment:
      - PACKAGE: mobx_codegen/example
    steps:
      - attach_workspace:
          at: /project
      - run: tool/circle_run.sh

workflows:
  version: 2.1
  mobx_packages:
    jobs:
      - get_sources
      - build_mobx:
          requires:
            - get_sources
      - build_mobx_codegen:
          requires:
            - get_sources
      - build_mobx_codegen_example:
          requires:
            - get_sources
